{"version":3,"sources":["store.js","pages/main/Main.jsx","pages/layout/Layout.jsx","Routes.jsx","App.jsx","index.js"],"names":["createContext","initialData","map","label","id","Consumer","Object","classCallCheck","this","_","uniqueId","isBusy","data","done","_this","Error","setTimeout","Main","_useState","useState","_useState2","slicedToArray","streamData","setStreamData","_useState3","value","_useState4","producers","setProducers","_useState5","_useState6","consumers","setConsumers","inputChange","index","newProducers","toConsumableArray","splice","useEffect","processor","setInterval","_stream","shift","findIndex","c","nextAvailableConsumer","consume","consumer","__consumers","_consumers","processStream","length","clearInterval","react_default","a","createElement","className","onClick","concat","p","key","onChange","e","target","onKeyPress","Layout","_ref","children","PrivateRoute","Component","component","rest","objectWithoutProperties","react_router","assign","render","props","withRouter","loginRedirect","to","Routes_PrivateRoute","exact","path","AppHistory","createBrowserHistory","store","setContext","src_store","Provider","history","src_Routes","document","getElementById"],"mappings":"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","file":"static/js/main.61f6c79d.chunk.js","sourcesContent":["import { createContext } from 'react';\n\n\n\nexport default createContext();\n","import _ from 'lodash';\nimport React, { useEffect, useState } from \"react\";\nimport \"./main.scss\";\n\nconst initialData = [\"hello\", \"world\", \"javascript\", \"typescirpt\", \"random\", \"data\", \"another random\"].map(\n  (label, id) => ({ id, label })\n);\n\nclass Consumer {\n  constructor() {\n    this.id = _.uniqueId('consumer_');\n    this.isBusy = false;\n    this.data = null;\n  }\n\n  consume(data, done) {\n    if(this.isBusy) throw new Error('Busy');\n    this.isBusy = true;\n    this.data = data;\n    setTimeout(() => {\n      this.isBusy = false;\n      this.data = null;\n      done(this);\n    }, 1000);\n  }\n}\n\nexport default () => {\n  const [streamData, setStreamData] = useState(initialData);\n  const [producers, setProducers] = useState([\n    {\n      value: \"\"\n    }\n  ]);\n\n  const [consumers, setConsumers] = useState([new Consumer(), new Consumer()]);\n\n  const addProducer = () => {\n    setProducers([...producers, { value: \"\" }]);\n  };\n\n  const inputChange = (index, value) => {\n    const newProducers = [...producers];\n    newProducers.splice(index, 1, { value });\n    setProducers(newProducers);\n  };\n\n  const produce = (index, label) => {\n    setStreamData([...streamData, { id: streamData.length + 1, label }]);\n    inputChange(index, \"\");\n  };\n\n  const processStream = () => {\n    const _stream = [...streamData];\n    const data = _stream.shift();\n    const index = consumers.findIndex(c => !c.isBusy);\n\n    if (data && index > -1) {\n      const nextAvailableConsumer = consumers[index];\n      nextAvailableConsumer.consume(data, function done(consumer) {\n        const __consumers = [...consumers];\n        const id = __consumers.findIndex(c => c.id === consumer.id)\n        __consumers.splice(id, 1, nextAvailableConsumer);\n        setConsumers(__consumers);\n      });\n      const _consumers = [...consumers];\n      _consumers.splice(index, 1, nextAvailableConsumer);\n      setConsumers(_consumers);\n      setStreamData(_stream);\n    }\n  };\n\n  useEffect(() => {\n    const processor = setInterval(() => {\n      processStream();\n      if (!streamData.length) clearInterval(processor);\n    }, 500);\n\n    return () => clearInterval(processor);\n  }, [streamData]);\n\n  return (\n    <div className=\"stream-demo\">\n      <div className=\"producers\">\n        <button className=\"add\" onClick={addProducer}>\n          +\n        </button>\n        {producers.map((p, id) => (\n          <div key={id} className=\"producer\">\n            <span className=\"name\">{`P${id + 1}`}</span>\n            <input\n              value={p.value}\n              onChange={e => inputChange(id, e.target.value)}\n              onKeyPress={e => {\n                if (e.key === \"Enter\") {\n                  produce(id, e.target.value);\n                }\n              }}\n            />\n          </div>\n        ))}\n      </div>\n      <div className=\"storage\">\n        {streamData.map(data => (\n          <span key={data.id} className=\"data\">\n            {data.label}\n          </span>\n        ))}\n      </div>\n      <div className=\"consumers\">\n        {consumers.map((c, id) => (\n          <div key={id} className=\"consumer\">\n            <span className={c.isBusy ? 'name busy' : 'name'}>\n              {c.isBusy && <i className=\"fas fa-cog fa-spin\" />}\n              {!c.isBusy && <i className=\"fas fa-cog\" />}\n            </span>\n            {c.data && <span>{c.data.label}</span>}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\n\nexport default ({ children }) => {\n  return (\n    <div>\n      {children}\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Route, Switch, withRouter, Redirect } from \"react-router-dom\";\n\nimport { Main, Layout } from \"./pages\";\n\nconst isLoggedIn = () => true;\n\nconst PrivateRoute = ({ component: Component, ...rest }) => {\n  return (\n    <Route\n      {...rest}\n      render={props =>\n        isLoggedIn() ? (\n          <Layout>\n            <Component {...props} />\n          </Layout>\n        ) : (\n          <Redirect\n            to={{ pathname: \"/login\", state: { from: props.location } }}\n          />\n        )\n      }\n    />\n  );\n};\n\nconst Routes = () => {\n  const loginRedirect = () =>\n    isLoggedIn() ? (\n      <Redirect to=\"/\" />\n    ) : (\n      <Route path=\"/login\" title=\"Stream Demo\" component={Main} />\n    );\n  return (\n    <Switch>\n      <PrivateRoute exact path=\"/\" component={Main} />\n      <Route exact path=\"/\" render={loginRedirect} />\n      <Route exact path=\"/login\" render={loginRedirect} />\n      <Redirect to=\"/\" />\n    </Switch>\n  );\n};\n\nexport default withRouter(Routes);\n","import React, { useState } from 'react';\nimport { Router } from 'react-router-dom';\nimport { createBrowserHistory } from 'history';\n\nimport StoreContext from './store';\nimport Routes from './Routes';\n\nexport const AppHistory = createBrowserHistory();\n\nexport default () => {\n\n\tconst [store, setContext] = useState({});\n\treturn (\n\t\t<StoreContext.Provider value={{store, setContext}}>\n\t\t\t<Router history={AppHistory}>\n        <Routes/>\n      </Router>\n\t\t</StoreContext.Provider>\n\t);\n}\n","import React from 'react';\nimport { render } from 'react-dom';\n\nimport './index.scss';\nimport App from './App';\n\nrender(<App />, document.getElementById('root'));\n"],"sourceRoot":""}